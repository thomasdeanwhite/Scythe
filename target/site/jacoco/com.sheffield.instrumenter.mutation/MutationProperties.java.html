<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MutationProperties.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Light-weight Instrumentation</a> &gt; <a href="index.source.html" class="el_package">com.sheffield.instrumenter.mutation</a> &gt; <span class="el_source">MutationProperties.java</span></div><h1>MutationProperties.java</h1><pre class="source lang-java linenums">package com.sheffield.instrumenter.mutation;

import java.lang.reflect.Field;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;
import java.util.Set;

import com.sheffield.instrumenter.InstrumentationProperties.Parameter;
import com.sheffield.instrumenter.PropertySource;

public class MutationProperties implements PropertySource {

    @Parameter(key = &quot;active_mutant_file&quot;, description = &quot;File containing IDs of active mutants for mutation testing&quot;, hasArgs = true, category = &quot;Mutation&quot;)
<span class="nc" id="L16">    public static String ACTIVE_MUTANT_FILE = &quot;&quot;;</span>

    @Parameter(key = &quot;visit_mutants&quot;, description = &quot;Whether or not to use mutants generated by a mutant-generation tool&quot;, hasArgs = true, category = &quot;Mutation&quot;)
<span class="nc" id="L19">    public static boolean VISIT_MUTANTS = false;</span>

    @Parameter(key = &quot;major_root&quot;, description = &quot;When using mutants, it is necessary to have the major jar file on the class path. This property represents the path to major&quot;, hasArgs = true, category = &quot;Mutation&quot;)
<span class="nc" id="L22">    public static String MAJOR_ROOT = &quot;&quot;;</span>

<span class="nc" id="L24">    protected Map&lt;String, Field&gt; parameterMap = new HashMap&lt;String, Field&gt;();</span>
<span class="nc" id="L25">    protected Map&lt;String, Parameter&gt; annotationMap = new HashMap&lt;String, Parameter&gt;();</span>
<span class="nc" id="L26">    protected Map&lt;String, ArrayList&lt;String&gt;&gt; categoryMap = new HashMap&lt;String, ArrayList&lt;String&gt;&gt;();</span>

    private void reflectMap() {
<span class="nc bnc" id="L29" title="All 2 branches missed.">        for (Field field : Arrays.asList(getClass().getFields())) {</span>
<span class="nc bnc" id="L30" title="All 2 branches missed.">            if (field.isAnnotationPresent(Parameter.class)) {</span>
<span class="nc" id="L31">                Parameter p = field.getAnnotation(Parameter.class);</span>
<span class="nc" id="L32">                String key = p.key();</span>
<span class="nc" id="L33">                parameterMap.put(key, field);</span>
<span class="nc" id="L34">                annotationMap.put(key, p);</span>
<span class="nc bnc" id="L35" title="All 2 branches missed.">                if (categoryMap.containsKey(p.category())) {</span>
<span class="nc" id="L36">                    categoryMap.get(p.category()).add(key);</span>
                } else {
<span class="nc" id="L38">                    ArrayList&lt;String&gt; cats = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L39">                    cats.add(key);</span>
<span class="nc" id="L40">                    categoryMap.put(p.category(), cats);</span>
                }

            }
<span class="nc" id="L44">        }</span>
<span class="nc" id="L45">    }</span>

<span class="nc" id="L47">    protected MutationProperties() {</span>
<span class="nc" id="L48">        reflectMap();</span>
<span class="nc" id="L49">    }</span>

    @Override
    public boolean hasParameter(String name) {
<span class="nc" id="L53">        return parameterMap.keySet().contains(name);</span>
    }

    @Override
    public Set&lt;String&gt; getParameterNames() {
<span class="nc" id="L58">        return parameterMap.keySet();</span>
    }

    @SuppressWarnings({ &quot;unchecked&quot;, &quot;rawtypes&quot; })
    @Override
    public void setParameter(String name, String value) throws IllegalAccessException {
<span class="nc bnc" id="L64" title="All 2 branches missed.">        if (!parameterMap.containsKey(name)) {</span>
<span class="nc" id="L65">            throw new IllegalArgumentException(name + &quot; was not found in the InstrumentationProperties class&quot;);</span>
        }
<span class="nc" id="L67">        Field f = parameterMap.get(name);</span>
<span class="nc" id="L68">        Class&lt;?&gt; cl = f.getType();</span>
<span class="nc bnc" id="L69" title="All 4 branches missed.">        if (cl.isAssignableFrom(Number.class) || cl.isPrimitive()) {</span>
<span class="nc bnc" id="L70" title="All 4 branches missed.">            if (cl.equals(Long.class) || cl.equals(long.class)) {</span>
                try {
<span class="nc" id="L72">                    Long l = Long.parseLong(value);</span>
<span class="nc" id="L73">                    f.setLong(null, l);</span>
<span class="nc" id="L74">                } catch (NumberFormatException e) {</span>
<span class="nc" id="L75">                    Double fl = Double.parseDouble(value);</span>
<span class="nc" id="L76">                    f.setLong(null, (long) fl.doubleValue());</span>
<span class="nc" id="L77">                }</span>
<span class="nc bnc" id="L78" title="All 4 branches missed.">            } else if (cl.equals(Double.class) || cl.equals(double.class)) {</span>
<span class="nc" id="L79">                Double d = Double.parseDouble(value);</span>
<span class="nc" id="L80">                f.setDouble(null, d);</span>
<span class="nc bnc" id="L81" title="All 4 branches missed.">            } else if (cl.equals(Float.class) || cl.equals(float.class)) {</span>
<span class="nc" id="L82">                Float fl = Float.parseFloat(value);</span>
<span class="nc" id="L83">                f.setFloat(null, fl);</span>
<span class="nc bnc" id="L84" title="All 4 branches missed.">            } else if (cl.equals(Integer.class) || cl.equals(int.class)) {</span>
<span class="nc" id="L85">                Double fl = Double.parseDouble(value);</span>
<span class="nc" id="L86">                f.setInt(null, (int) fl.doubleValue());</span>
<span class="nc bnc" id="L87" title="All 4 branches missed.">            } else if (cl.equals(Boolean.class) || cl.equals(boolean.class)) {</span>
<span class="nc" id="L88">                Boolean bl = Boolean.parseBoolean(value);</span>
<span class="nc" id="L89">                f.setBoolean(null, bl);</span>
<span class="nc" id="L90">            }</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">        } else if (cl.isAssignableFrom(String.class)) {</span>
<span class="nc" id="L92">            f.set(null, value);</span>
        }
<span class="nc bnc" id="L94" title="All 2 branches missed.">        if (f.getType().isEnum()) {</span>
<span class="nc" id="L95">            f.set(null, Enum.valueOf((Class&lt;Enum&gt;) f.getType(), value.toUpperCase()));</span>
        }
<span class="nc" id="L97">    }</span>

    private static MutationProperties instance;

    public static MutationProperties instance() {
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (instance == null) {</span>
<span class="nc" id="L103">            instance = new MutationProperties();</span>
        }
<span class="nc" id="L105">        return instance;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>